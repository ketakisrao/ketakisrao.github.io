<!DOCTYPE html>
<html>
<head>
	<title>Whack-a-mole</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="css/jquery-ui.css"/>
	<link rel="stylesheet" href="css/bootstrap.css"/>
	<link rel="stylesheet" href="css/whackamole.css"/>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-7">
				<div id="whackGrid" class="grid-container">
				</div>
				<button id="start" onClick="startGame()">Start</button>
				<span id="counterHolder"></span>
			</div>
			<div class="col-md-5 instruction">
				Whack(click) the moles to get the highest score. Hurry, you have only 30 seconds!
				</div>
			</div>
		</div>
	</div>
	
	<script src="js/jquery.js"></script>
	<script src='js/jquery-ui.min.js'></script>
	<script src="js/popper.js"></script>
	<script src="js/bootstrap.js"></script>
	<script type="text/javascript">
		var counter = 0;
		var maxTime = 2000;
		var minTime = 700;
		var counterHolder, inter, timeout, interval;
		$(document).ready(function(){
			if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
				interval = 1000;
				minTime = 600;
				maxTime = 1500;
			}
			else{
				interval = 1500;
			}
			var grid = document.getElementById('whackGrid');
			var p = "";
			var gridTemp = "";
			var height = grid.clientWidth/6;
			for(i=0; i<6; i++){
				gridTemp += height + "px "
			}
			$(grid).css('grid-template-columns', gridTemp);
			for(i=0; i<36; i++){
				p += '<div class="grid-item" style="height: ' + height + 'px;" id="box_' + (i + 1) + '" onClick="moleHit(this.id)"><img draggable="false" src="whackamole/mole.png" style="display:none; max-width: 100%"/></div>';
			}
			grid.innerHTML = p;
			counterHolder = document.getElementById("counterHolder");
		});
		function getRandom(min, max){
			if(min)
				return Math.random() * (max - min) + min;
			else
				return Math.trunc((Math.random() * 10) % 6);
		}
		function clearMoles(){
			for(i=1; i<=36; i++){
				$("#box_" + i + " img").hide();
			}
		}
		function generateMoles(){
			var row = getRandom();
			var col = getRandom();
			var boxNo = row * 6 + col + 1;
			if(boxNo <= 36)
			{
				$("#box_" + boxNo + " img").show('slide', {direction: 'down'}, 500);
				(function(b){
					setTimeout(function(){
						$("#box_" + boxNo + " img").hide('slide', {direction: 'down'}, 500);
					}, getRandom(minTime, maxTime));
				})(boxNo);
			}
		}
		function gameOver(inter, timeout){
			var button = document.getElementById("start");
			button.innerHTML = "Start";
			counterHolder.innerHTML = '';
			clearInterval(inter);
			if(timeout){
				clearTimeout(timeout);
			}
			clearMoles();
			alert("Game Over, your score is " + counter + "!");
		}
		function startGame(){
			var button = document.getElementById("start");
			if(button.innerHTML == 'Start'){
				counter = 0;
				inter = setInterval(function(){
					var times = getRandom();
					for(i=0; i<times; i++){
						generateMoles();
					}
				}, interval);
				button.innerHTML = "Stop";
				timeout = setTimeout(function(){
					gameOver(inter);
				}, 30000);
			}
			else{
				gameOver(inter, timeout);
			}
		}
		function moleHit(boxNo){
			if($("#" + boxNo + " img").css('display') != 'none'){
				counter ++;
				$("#" + boxNo + " img").hide('puff', 150);
				counterHolder.innerHTML = counter;
			}
		}
	</script>
</body>
</html>